<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">

<!-- Header -->
<header class="bg-blue-600 text-white p-4 shadow flex justify-between items-center">
    <h1 class="text-2xl font-bold">H·ªá th·ªëng qu·∫£n l√Ω ti√™m ch·ªßng - Trang Admin</h1>
    <div class="flex items-center space-x-4">
        <span id="adminName">Admin</span>
        <button onclick="logout()" class="bg-red-500 px-4 py-2 rounded hover:bg-red-600">ƒêƒÉng xu·∫•t</button>
    </div>
</header>

<div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow h-screen">
        <nav class="flex flex-col p-4 space-y-2">
            <button onclick="showSection('dashboard')" class="hover:bg-blue-100 p-2 rounded flex items-center">
                <i class="fas fa-chart-line w-6"></i>
                <span>T·ªïng quan</span>
            </button>
            <button onclick="showSection('users')" class="hover:bg-blue-100 p-2 rounded flex items-center">
                <i class="fas fa-users w-6"></i>
                <span>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</span>
            </button>
            <button onclick="showSection('vaccines')" class="hover:bg-blue-100 p-2 rounded flex items-center">
                <i class="fas fa-syringe w-6"></i>
                <span>Qu·∫£n l√Ω vaccine</span>
            </button>
        </nav>
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-6">
        <!-- Dashboard -->
        <section id="dashboard" class="space-y-4">
            <h2 class="text-xl font-semibold mb-4">üìä T·ªïng quan th·ªëng k√™</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="bg-white p-6 rounded shadow">
                    <h3 class="text-lg font-semibold mb-2">üë∂ S·ªë tr·∫ª theo gi·ªõi t√≠nh</h3>
                    <div id="genderStats" class="space-y-2">ƒêang t·∫£i...</div>
                </div>
                <div class="bg-white p-6 rounded shadow">
                    <h3 class="text-lg font-semibold mb-2">üìà S·ªë tr·∫ª theo ƒë·ªô tu·ªïi</h3>
                    <div id="ageStats" class="space-y-2">ƒêang t·∫£i...</div>
                </div>
                <div class="bg-white p-6 rounded shadow">
                    <h3 class="text-lg font-semibold mb-2">üìÖ L·ªãch h·∫πn theo th√°ng</h3>
                    <div id="appointmentStats" class="space-y-2">ƒêang t·∫£i...</div>
                </div>
                <div class="bg-white p-6 rounded shadow">
                    <h3 class="text-lg font-semibold mb-2">üìä T·ªïng quan h·ªá th·ªëng</h3>
                    <div id="dashboardSummary" class="space-y-2">ƒêang t·∫£i...</div>
                </div>
            </div>
        </section>

        <!-- User management -->
        <section id="users" class="hidden space-y-4">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
                <div class="flex space-x-4 items-center">
                    <div class="flex items-center space-x-2">
                        <label for="userRoleFilter" class="text-sm font-medium">L·ªçc theo role:</label>
                        <select id="userRoleFilter" class="border rounded px-3 py-2">
                            <option value="">T·∫•t c·∫£ role</option>
                            <option value="ROLE_USER">User</option>
                            <option value="ROLE_ADMIN">Admin</option>
                            <option value="ROLE_DOCTOR">Doctor</option>
                        </select>
                        <button onclick="loadUsers()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                            <i class="fas fa-search"></i> T√¨m ki·∫øm
                        </button>
                    </div>
                    <button onclick="showAddUserForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        <i class="fas fa-plus"></i> Th√™m ng∆∞·ªùi d√πng
                    </button>
                </div>
            </div>
            
            <!-- Add User Form -->
            <div id="addUserForm" class="hidden bg-white p-4 rounded shadow mb-4">
                <h3 class="text-lg font-semibold mb-4">Th√™m ng∆∞·ªùi d√πng m·ªõi</h3>
                <form id="newUserForm" class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-1">T√™n ng∆∞·ªùi d√πng</label>
                        <input type="text" name="userName" class="border rounded px-2 py-1 w-full" required>
                    </div>
                    <div>
                        <label class="block mb-1">Email</label>
                        <input type="email" name="email" class="border rounded px-2 py-1 w-full" required>
                    </div>
                    <div>
                        <label class="block mb-1">M·∫≠t kh·∫©u</label>
                        <input type="password" name="password" class="border rounded px-2 py-1 w-full" required>
                    </div>
                    <div>
                        <label class="block mb-1">Role</label>
                        <select name="userRole" class="border rounded px-2 py-1 w-full" required>
                            <option value="User">User</option>
                            <option value="Admin">Admin</option>
                            <option value="Doctor">Doctor</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1">Gi·ªõi t√≠nh</label>
                        <select name="gender" class="border rounded px-2 py-1 w-full" required>
                            <option value="Male">Nam</option>
                            <option value="Female">N·ªØ</option>
                            <option value="Other">Kh√°c</option>
                        </select>
                    </div>
                    <div>
                        <label class="block mb-1">Ng√†y sinh</label>
                        <input type="date" name="birthDate" class="border rounded px-2 py-1 w-full" required>
                    </div>
                    <div class="col-span-2 flex justify-end space-x-2">
                        <button type="button" onclick="hideAddUserForm()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">H·ªßy</button>
                        <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Th√™m</button>
                    </div>
                </form>
            </div>

            <!-- Users Table -->
            <div class="bg-white p-4 rounded shadow overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="px-4 py-2 text-left">ID</th>
                            <th class="px-4 py-2 text-left">T√™n</th>
                            <th class="px-4 py-2 text-left">Email</th>
                            <th class="px-4 py-2 text-left">Role</th>
                            <th class="px-4 py-2 text-left">Gi·ªõi t√≠nh</th>
                            <th class="px-4 py-2 text-left">Ng√†y sinh</th>
                            <th class="px-4 py-2 text-left">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <tr>
                            <td colspan="7" class="px-4 py-2 text-center">ƒêang t·∫£i danh s√°ch...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Vaccine management -->
        <section id="vaccines" class="hidden space-y-4">
            <h2 class="text-xl font-semibold mb-4">üíâ Qu·∫£n l√Ω vaccine</h2>
            <div class="bg-white p-4 rounded shadow overflow-x-auto">
                <table class="min-w-full">
                    <thead>
                        <tr class="border-b">
                            <th class="px-4 py-2 text-left">ID</th>
                            <th class="px-4 py-2 text-left">T√™n vaccine</th>
                            <th class="px-4 py-2 text-left">Lo·∫°i g√≥i</th>
                            <th class="px-4 py-2 text-left">Gi√°</th>
                            <th class="px-4 py-2 text-left">Thao t√°c</th>
                        </tr>
                    </thead>
                    <tbody id="vaccineTableBody">
                        <tr>
                            <td colspan="5" class="px-4 py-2 text-center">ƒêang t·∫£i danh s√°ch...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>
</div>

<script>
    // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
    function checkAuth() {
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');
        if (!token || !role.includes('ROLE_Admin')) {
            window.location.href = '/login';
        }
    }

    // ƒêƒÉng xu·∫•t
    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('role');
        window.location.href = '/login';
    }

    // Hi·ªÉn th·ªã/·∫©n section
    function showSection(id) {
        document.querySelectorAll('main section').forEach(section => section.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        if (id === 'dashboard') {
            loadDashboardData();
        } else if (id === 'users') {
            loadUsers();
        } else if (id === 'vaccines') {
            loadVaccines();
        }
    }

    // Load d·ªØ li·ªáu dashboard
    async function loadDashboardData() {
        try {
            const token = localStorage.getItem('token');
            const headers = {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            };

            const [dashboard, gender, age, appointments] = await Promise.all([
                fetch('/api/admin/dashboard', { headers }).then(res => res.json()),
                fetch('/api/admin/children-by-gender', { headers }).then(res => res.json()),
                fetch('/api/admin/children-by-age-group', { headers }).then(res => res.json()),
                fetch('/api/admin/monthly-appointments?year=2024', { headers }).then(res => res.json())
            ]);

            // Hi·ªÉn th·ªã t·ªïng quan
            document.getElementById('dashboardSummary').innerHTML = `
                <div>T·ªïng s·ªë ng∆∞·ªùi d√πng: ${dashboard.totalUsers || 0}</div>
                <div>T·ªïng s·ªë tr·∫ª: ${dashboard.totalChildren || 0}</div>
                <div>T·ªïng s·ªë cu·ªôc h·∫πn: ${dashboard.totalAppointments || 0}</div>
            `;

            // Hi·ªÉn th·ªã th·ªëng k√™ theo gi·ªõi t√≠nh
            document.getElementById('genderStats').innerHTML = Object.entries(gender)
                .map(([key, value]) => `<div>${key}: ${value}</div>`)
                .join('');

            // Hi·ªÉn th·ªã th·ªëng k√™ theo ƒë·ªô tu·ªïi
            document.getElementById('ageStats').innerHTML = Object.entries(age)
                .map(([key, value]) => `<div>${key}: ${value}</div>`)
                .join('');

            // Hi·ªÉn th·ªã th·ªëng k√™ l·ªãch h·∫πn
            document.getElementById('appointmentStats').innerHTML = appointments
                .map(apt => `<div>${apt.month}: ${apt.count}</div>`)
                .join('');
        } catch (err) {
            console.error('L·ªói khi t·∫£i d·ªØ li·ªáu dashboard:', err);
        }
    }

    // Load danh s√°ch ng∆∞·ªùi d√πng
    async function loadUsers() {
        try {
            const token = localStorage.getItem('token');
            const roleFilter = document.getElementById('userRoleFilter').value;
            let url = '/api/admin/users';
            
            // Ch·ªâ th√™m tham s·ªë role n·∫øu ƒë√£ ch·ªçn role c·ª• th·ªÉ
            if (roleFilter && roleFilter !== '') {
                // Kh√¥ng c·∫ßn chuy·ªÉn ƒë·ªïi v√¨ gi√° tr·ªã ƒë√£ match v·ªõi database
                url = `/api/admin/users/role?userRole=${roleFilter}`;
            }
            
            console.log('Fetching users with URL:', url); // Debug log
            
            const response = await fetch(url, {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            });
            
            // Log full response for debugging
            console.log('Response status:', response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Server response:', errorText);
                throw new Error(errorText || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch ng∆∞·ªùi d√πng');
            }
            
            const users = await response.json();
            console.log('Received users:', users);
            
            window.usersData = users;
            const tbody = document.getElementById('userTableBody');
            
            if (!Array.isArray(users) || users.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-4 py-2 text-center">Kh√¥ng c√≥ ng∆∞·ªùi d√πng n√†o</td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = users.map(user => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2">${user.userId}</td>
                    <td class="px-4 py-2">${user.userName || 'N/A'}</td>
                    <td class="px-4 py-2">${user.email || 'N/A'}</td>
                    <td class="px-4 py-2">${user.userRole?.replace('ROLE_', '') || 'N/A'}</td>
                    <td class="px-4 py-2">${user.gender || 'N/A'}</td>
                    <td class="px-4 py-2">${user.birthDate ? new Date(user.birthDate).toLocaleDateString() : 'N/A'}</td>
                    <td class="px-4 py-2">
                        <button onclick="editUser(${user.userId})" class="text-blue-500 hover:text-blue-700 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteUser(${user.userId})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        } catch (err) {
            console.error('L·ªói khi t·∫£i danh s√°ch ng∆∞·ªùi d√πng:', err);
            document.getElementById('userTableBody').innerHTML = `
                <tr>
                    <td colspan="7" class="px-4 py-2 text-center text-red-500">
                        L·ªói khi t·∫£i danh s√°ch: ${err.message}
                    </td>
                </tr>
            `;
        }
    }

    // Load danh s√°ch vaccine
    async function loadVaccines() {
        try {
            const token = localStorage.getItem('token');
            const response = await fetch('/api/admin/vaccines', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            const vaccines = await response.json();
            const tbody = document.getElementById('vaccineTableBody');
            
            tbody.innerHTML = vaccines.map(vaccine => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-2">${vaccine.vaccineId}</td>
                    <td class="px-4 py-2">${vaccine.vaccineName}</td>
                    <td class="px-4 py-2">${vaccine.packageType}</td>
                    <td class="px-4 py-2">${vaccine.price}</td>
                    <td class="px-4 py-2">
                        <button onclick="editVaccine(${vaccine.vaccineId})" class="text-blue-500 hover:text-blue-700">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        } catch (err) {
            console.error('L·ªói khi t·∫£i danh s√°ch vaccine:', err);
        }
    }

    // Hi·ªÉn th·ªã form th√™m ng∆∞·ªùi d√πng
    function showAddUserForm() {
        document.getElementById('addUserForm').classList.remove('hidden');
    }

    // ·∫®n form th√™m ng∆∞·ªùi d√πng
    function hideAddUserForm() {
        document.getElementById('addUserForm').classList.add('hidden');
    }

    // X·ª≠ l√Ω th√™m ng∆∞·ªùi d√πng
    document.getElementById('newUserForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        try {
            const token = localStorage.getItem('token');
            const formData = new FormData(e.target);
            
            // Log raw form data
            console.log('Raw form data:');
            for (let pair of formData.entries()) {
                console.log(pair[0] + ': ' + pair[1]);
            }
            
            const userData = {
                userName: formData.get('userName'),
                email: formData.get('email'),
                password: formData.get('password'),
                userRole: formData.get('userRole'),
                gender: formData.get('gender'),
                birthDate: formData.get('birthDate')
            };
            
            console.log('Sending user data:', userData);
            
            const response = await fetch('/api/admin/add/users', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Kh√¥ng th·ªÉ th√™m ng∆∞·ªùi d√πng');
            }
            
            const result = await response.json();
            console.log('User added successfully:', result);
            
            hideAddUserForm();
            e.target.reset(); // Reset form
            loadUsers();
            alert('Th√™m ng∆∞·ªùi d√πng th√†nh c√¥ng!');
        } catch (err) {
            console.error('L·ªói khi th√™m ng∆∞·ªùi d√πng:', err);
            alert('L·ªói khi th√™m ng∆∞·ªùi d√πng: ' + err.message);
        }
    });

    // X·ª≠ l√Ω s·ª≠a ng∆∞·ªùi d√πng
    async function editUser(userId) {
        try {
            // L·∫•y th√¥ng tin ng∆∞·ªùi d√πng t·ª´ danh s√°ch ƒë√£ l∆∞u
            const user = window.usersData.find(u => u.userId === userId);
            if (!user) {
                throw new Error('Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi d√πng');
            }

            // Hi·ªÉn th·ªã form ch·ªânh s·ª≠a
            const form = document.createElement('form');
            form.innerHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                    <div class="bg-white p-6 rounded-lg w-96">
                        <h3 class="text-lg font-semibold mb-4">Ch·ªânh s·ª≠a ng∆∞·ªùi d√πng</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block mb-1">T√™n ng∆∞·ªùi d√πng</label>
                                <input type="text" name="userName" value="${user.userName || ''}" class="border rounded px-2 py-1 w-full">
                            </div>
                            <div>
                                <label class="block mb-1">Email</label>
                                <input type="email" name="email" value="${user.email || ''}" class="border rounded px-2 py-1 w-full">
                            </div>
                            <div>
                                <label class="block mb-1">Role</label>
                                <select name="userRole" class="border rounded px-2 py-1 w-full">
                                    <option value="User" ${user.userRole === 'ROLE_User' ? 'selected' : ''}>User</option>
                                    <option value="Admin" ${user.userRole === 'ROLE_Admin' ? 'selected' : ''}>Admin</option>
                                    <option value="Doctor" ${user.userRole === 'ROLE_Doctor' ? 'selected' : ''}>Doctor</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-1">Gi·ªõi t√≠nh</label>
                                <select name="gender" class="border rounded px-2 py-1 w-full">
                                    <option value="Male" ${user.gender === 'Male' ? 'selected' : ''}>Nam</option>
                                    <option value="Female" ${user.gender === 'Female' ? 'selected' : ''}>N·ªØ</option>
                                    <option value="Other" ${user.gender === 'Other' ? 'selected' : ''}>Kh√°c</option>
                                </select>
                            </div>
                            <div>
                                <label class="block mb-1">Ng√†y sinh</label>
                                <input type="date" name="birthDate" value="${user.birthDate ? user.birthDate.split('T')[0] : ''}" class="border rounded px-2 py-1 w-full">
                            </div>
                            <div>
                                <label class="block mb-1">M·∫≠t kh·∫©u m·ªõi (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng ƒë·ªïi)</label>
                                <input type="password" name="password" class="border rounded px-2 py-1 w-full">
                            </div>
                            <div class="flex justify-end space-x-2">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">H·ªßy</button>
                                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">L∆∞u</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(form);
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                try {
                    const formData = new FormData(e.target);
                    const updateData = new URLSearchParams();
                    
                    // Ch·ªâ th√™m c√°c tr∆∞·ªùng c√≥ gi√° tr·ªã v√† ƒë√£ thay ƒë·ªïi
                    if (formData.get('userName') && formData.get('userName') !== user.userName) 
                        updateData.append('userName', formData.get('userName'));
                    if (formData.get('email') && formData.get('email') !== user.email) 
                        updateData.append('email', formData.get('email'));
                    if (formData.get('userRole') && formData.get('userRole') !== user.userRole) 
                        updateData.append('userRole', formData.get('userRole'));
                    if (formData.get('gender') && formData.get('gender') !== user.gender) 
                        updateData.append('gender', formData.get('gender'));
                    if (formData.get('birthDate') && formData.get('birthDate') !== user.birthDate?.split('T')[0]) 
                        updateData.append('birthDate', formData.get('birthDate'));
                    if (formData.get('password')) 
                        updateData.append('password', formData.get('password'));

                    // N·∫øu kh√¥ng c√≥ tr∆∞·ªùng n√†o thay ƒë·ªïi
                    if (updateData.toString() === '') {
                        alert('Kh√¥ng c√≥ th√¥ng tin n√†o ƒë∆∞·ª£c thay ƒë·ªïi');
                        return;
                    }
                    
                    console.log('Sending update data:', updateData.toString());
                    
                    const token = localStorage.getItem('token');
                    const updateResponse = await fetch(`/api/admin/users/${userId}?${updateData.toString()}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/x-www-form-urlencoded'
                        }
                    });
                    
                    if (!updateResponse.ok) {
                        const errorData = await updateResponse.json();
                        throw new Error(errorData.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t ng∆∞·ªùi d√πng');
                    }
                    
                    const result = await updateResponse.json();
                    console.log('User updated successfully:', result);
                    
                    form.remove();
                    loadUsers();
                    alert('C·∫≠p nh·∫≠t ng∆∞·ªùi d√πng th√†nh c√¥ng!');
                } catch (err) {
                    console.error('L·ªói khi c·∫≠p nh·∫≠t ng∆∞·ªùi d√πng:', err);
                    alert('L·ªói khi c·∫≠p nh·∫≠t ng∆∞·ªùi d√πng: ' + err.message);
                }
            });
        } catch (err) {
            console.error('L·ªói khi l·∫•y th√¥ng tin ng∆∞·ªùi d√πng:', err);
            alert('L·ªói khi l·∫•y th√¥ng tin ng∆∞·ªùi d√πng: ' + err.message);
        }
    }

    // X·ª≠ l√Ω x√≥a ng∆∞·ªùi d√πng
    async function deleteUser(userId) {
        if (!confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?')) return;
        
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`/api/admin/users/${userId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Kh√¥ng th·ªÉ x√≥a ng∆∞·ªùi d√πng');
            }
            
            loadUsers();
            alert('X√≥a ng∆∞·ªùi d√πng th√†nh c√¥ng!');
        } catch (err) {
            console.error('L·ªói khi x√≥a ng∆∞·ªùi d√πng:', err);
            alert('L·ªói khi x√≥a ng∆∞·ªùi d√πng: ' + err.message);
        }
    }

    // X·ª≠ l√Ω c·∫≠p nh·∫≠t vaccine
    async function editVaccine(vaccineId) {
        const newPrice = prompt('Nh·∫≠p gi√° m·ªõi cho vaccine:');
        if (!newPrice) return;
        
        try {
            const token = localStorage.getItem('token');
            const response = await fetch(`/api/admin/vaccines/${vaccineId}`, {
                method: 'PATCH',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ price: newPrice })
            });
            
            if (response.ok) {
                loadVaccines();
            } else {
                alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t vaccine');
            }
        } catch (err) {
            console.error('L·ªói khi c·∫≠p nh·∫≠t vaccine:', err);
            alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t vaccine');
        }
    }

    // Ki·ªÉm tra ƒëƒÉng nh·∫≠p khi t·∫£i trang
    checkAuth();
    
    // Load d·ªØ li·ªáu dashboard khi t·∫£i trang
    loadDashboardData();
</script>
</body>
</html>
