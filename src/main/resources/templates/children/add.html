<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Thêm hồ sơ trẻ em - Trung tâm Tiêm chủng</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/responsive.css" />
  </head>
  <body>
    <!-- Header -->
    <div th:replace="fragments/header :: header"></div>

    <!-- Page Header -->
    <div class="page-header">
      <div class="container">
        <h1>Thêm hồ sơ trẻ em</h1>
      </div>
    </div>

    <!-- Add Child Form Section -->
    <section class="add-child-section">
      <div class="container">
        <div class="children-container">
          <!-- Sidebar -->
          <div th:replace="fragments/sidebar :: sidebar"></div>

          <!-- Main Content -->
          <div class="main-content">
            <div class="form-container">
              <form
                th:action="@{/children/add}"
                method="post"
                th:object="${child}"
                enctype="multipart/form-data"
                class="needs-validation"
                novalidate
              >
                <h2>Thông tin cơ bản</h2>

                <!-- Avatar Upload -->
                <div class="form-group">
                  <label>Ảnh đại diện</label>
                  <div class="avatar-upload">
                    <div class="avatar-preview">
                      <div
                        id="imagePreview"
                        style="
                          background-image: url(/images/child-placeholder.png);
                        "
                      ></div>
                    </div>
                    <div class="avatar-edit">
                      <input
                        type="file"
                        id="avatarUpload"
                        name="avatarFile"
                        accept=".jpg,.jpeg,.png"
                      />
                      <label for="avatarUpload">Chọn ảnh</label>
                    </div>
                  </div>
                </div>

                <!-- Basic Info -->
                <div class="form-row">
                  <div class="form-col">
                    <div class="form-group">
                      <label for="name"
                        >Họ và tên trẻ <span class="required">*</span></label
                      >
                      <input
                        type="text"
                        id="name"
                        name="name"
                        th:field="*{name}"
                        class="form-control"
                        required
                      />
                      <div
                        class="form-error"
                        th:if="${#fields.hasErrors('name')}"
                        th:errors="*{name}"
                      >
                        Vui lòng nhập tên trẻ
                      </div>
                    </div>
                  </div>
                  <div class="form-col">
                    <div class="form-group">
                      <label for="birthDate"
                        >Ngày sinh <span class="required">*</span></label
                      >
                      <input
                        type="date"
                        id="birthDate"
                        name="birthDate"
                        th:field="*{birthDate}"
                        class="form-control"
                        required
                      />
                      <div
                        class="form-error"
                        th:if="${#fields.hasErrors('birthDate')}"
                        th:errors="*{birthDate}"
                      >
                        Vui lòng chọn ngày sinh
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-col">
                    <div class="form-group">
                      <label>Giới tính <span class="required">*</span></label>
                      <div class="radio-group">
                        <div class="radio-item">
                          <input
                            type="radio"
                            id="genderMale"
                            name="gender"
                            value="M"
                            th:field="*{gender}"
                            required
                          />
                          <label for="genderMale">Nam</label>
                        </div>
                        <div class="radio-item">
                          <input
                            type="radio"
                            id="genderFemale"
                            name="gender"
                            value="F"
                            th:field="*{gender}"
                            required
                          />
                          <label for="genderFemale">Nữ</label>
                        </div>
                      </div>
                      <div
                        class="form-error"
                        th:if="${#fields.hasErrors('gender')}"
                        th:errors="*{gender}"
                      >
                        Vui lòng chọn giới tính
                      </div>
                    </div>
                  </div>
                  <div class="form-col">
                    <div class="form-group">
                      <label for="relationship"
                        >Mối quan hệ với người giám hộ
                        <span class="required">*</span></label
                      >
                      <select
                        id="relationship"
                        name="relationship"
                        th:field="*{relationship}"
                        class="form-control"
                        required
                      >
                        <option value="">-- Chọn --</option>
                        <option value="parent">Cha/Mẹ</option>
                        <option value="grandparent">Ông/Bà</option>
                        <option value="other">Khác</option>
                      </select>
                      <div
                        class="form-error"
                        th:if="${#fields.hasErrors('relationship')}"
                        th:errors="*{relationship}"
                      >
                        Vui lòng chọn mối quan hệ
                      </div>
                    </div>
                  </div>
                </div>

                <h2>Thông tin y tế</h2>

                <div class="form-row">
                  <div class="form-col">
                    <div class="form-group">
                      <label for="weight">Cân nặng (kg)</label>
                      <input
                        type="number"
                        id="weight"
                        name="weight"
                        th:field="*{weight}"
                        class="form-control"
                        step="0.1"
                        min="0"
                      />
                      <div
                        class="form-error"
                        th:if="${#fields.hasErrors('weight')}"
                        th:errors="*{weight}"
                      >
                        Vui lòng nhập cân nặng hợp lệ
                      </div>
                    </div>
                  </div>
                  <div class="form-col">
                    <div class="form-group">
                      <label for="height">Chiều cao (cm)</label>
                      <input
                        type="number"
                        id="height"
                        name="height"
                        th:field="*{height}"
                        class="form-control"
                        step="0.1"
                        min="0"
                      />
                      <div
                        class="form-error"
                        th:if="${#fields.hasErrors('height')}"
                        th:errors="*{height}"
                      >
                        Vui lòng nhập chiều cao hợp lệ
                      </div>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="allergies">Dị ứng (nếu có)</label>
                  <textarea
                    id="allergies"
                    name="allergies"
                    th:field="*{allergies}"
                    class="form-control"
                    rows="3"
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="medicalHistory">Tiền sử bệnh (nếu có)</label>
                  <textarea
                    id="medicalHistory"
                    name="medicalHistory"
                    th:field="*{medicalHistory}"
                    class="form-control"
                    rows="3"
                  ></textarea>
                </div>

                <div class="form-group">
                  <label>Các vaccine đã tiêm (nếu có)</label>
                  <div class="checkbox-group">
                    <div
                      class="checkbox-item"
                      th:each="vaccine : ${vaccineOptions}"
                    >
                      <input
                        type="checkbox"
                        th:id="${'vaccine-' + vaccine.id}"
                        th:name="previousVaccinations"
                        th:value="${vaccine.id}"
                      />
                      <label
                        th:for="${'vaccine-' + vaccine.id}"
                        th:text="${vaccine.name}"
                        >Vaccine Viêm gan B</label
                      >
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="note">Ghi chú thêm</label>
                  <textarea
                    id="note"
                    name="note"
                    th:field="*{note}"
                    class="form-control"
                    rows="3"
                  ></textarea>
                </div>

                <div class="form-actions">
                  <a href="/children/list" class="btn-outline">Hủy</a>
                  <button type="submit" class="btn-primary">Lưu hồ sơ</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <div th:replace="fragments/footer :: footer"></div>

    <script src="/js/main.js"></script>
    <script>
      // Image preview
      function readURL(input) {
        if (input.files && input.files[0]) {
          var reader = new FileReader();
          reader.onload = function (e) {
            document.getElementById("imagePreview").style.backgroundImage =
              "url(" + e.target.result + ")";
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      document
        .getElementById("avatarUpload")
        .addEventListener("change", function () {
          readURL(this);
        });
    </script>
  </body>
</html>
